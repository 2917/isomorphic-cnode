webpackJsonp([6],{109:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var s=t[a](o),u=s.value}catch(e){return void r(e)}return s.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),t.readPic=t.addReply=t.upsReply=t.markAllMessages=t.getMessages=t.addTopic=t.getUserData=t.getUserInfo=t.getTopic=t.getTopics=void 0;var s=r(110),u=n(s),c=r(46),i="https://cnodejs.org/api/v1",l=(0,c.createFetchJSON)(i),f=(t.getTopics=function(e){return l("/topics?"+u.default.stringify(e))},t.getTopic=function(e){return l("/topic/"+e)},function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,o,s,c,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/accesstoken",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u.default.stringify({accesstoken:t})},e.next=4,l(r,n);case 4:if(o=e.sent,s=o.success,c=o.error_msg,i=a(o,["success","error_msg"]),s){e.next=10;break}throw new Error(c);case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}());t.getUserInfo=f;t.getUserData=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l("/user/"+t);case 2:if(r=e.sent,n=r.success,a=r.error_msg,o=r.data,n){e.next=8;break}throw new Error(a);case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.addTopic=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,a,o,s,c;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/topics",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u.default.stringify(t)},e.next=4,l(r,n);case 4:if(a=e.sent,o=a.success,s=a.error_msg,c=a.topic_id,o){e.next=10;break}throw new Error(s);case 10:return e.abrupt("return",c);case 11:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.getMessages=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,a,o,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/messages?accesstoken="+t,e.next=3,l(r);case 3:if(n=e.sent,a=n.success,o=n.error_msg,s=n.data,a){e.next=9;break}throw new Error(o);case 9:return e.abrupt("return",s);case 10:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.markAllMessages=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/message/mark_all",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u.default.stringify({accesstoken:t})},e.next=4,l(r,n);case 4:if(a=e.sent,o=a.success){e.next=8;break}throw new Error(error_msg);case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.upsReply=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,a,o,s,c,i=t.replyId,f=t.accesstoken;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/reply/"+i+"/ups",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u.default.stringify({accesstoken:f})},e.next=4,l(r,n);case 4:if(a=e.sent,o=a.success,s=a.action,c=a.error_msg,o){e.next=10;break}throw new Error(c);case 10:return e.abrupt("return",s);case 11:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.addReply=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,a,o,s,c,i,f=t.topicId,p=t.accesstoken,d=t.content,m=t.replyId;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/topic/"+f+"/replies",n={accesstoken:p,content:d},m&&(n.reply_id=m),a={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:u.default.stringify(n)},e.next=6,l(r,a);case 6:if(o=e.sent,s=o.success,c=o.error_msg,i=o.reply_id,s){e.next=12;break}throw new Error(c);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.readPic=function(){var e=o(regeneratorRuntime.mark(function e(t){var r,n,a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="http://m.yueqingwang.com/common.ashx",n={method:"POST",body:JSON.stringify({img:t})},e.next=4,fetch(r,n);case 4:return a=e.sent,e.next=7,a.text();case 7:if(o=e.sent,"qrcode error"===o){e.next=10;break}throw new Error("二维码图片不清晰");case 10:return e.abrupt("return",o);case 11:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},140:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var s=t[a](o),u=s.value}catch(e){return void r(e)}return s.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=r(39),l=a(i),f=r(141),p=a(f),d=r(142),m=n(d),v=r(113),h=function(e){function t(){var e,r,n,a;s(this,t);for(var c=arguments.length,i=Array(c),l=0;l<c;l++)i[l]=arguments[l];return r=n=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),n.name="Message",n.needLogin=!0,n.View=p.default,n.actions=m,n.initialState={showMenu:!1,user:{},selectItem:"hasnot_read",currentData:[]},n.methods={openMenu:v.openMenu,closeMenu:v.closeMenu,changeItem:function(e){var t=e.currentTarget,r=this.store.actions.UPDATE_FIELD,n=t.getAttribute("data-type");r({key:"selectItem",value:n})},markAll:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var r,n,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.store.actions,n=r.MARK_ALL_MESSAGES,a=r.INIT,t.prev=1,t.next=4,n();case 4:return t.next=6,a();case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),alert(t.t0.message);case 11:case"end":return t.stop()}},t,e,[[1,8]])}))()}},a=r,u(n,a)}return c(t,e),t}(l.default);t.default=h},141:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.state,r=e.methods,n=t.showMenu,a=(t.user,t.userInfo),u=t.selectItem,i=(t.has_read_messages,t.hasnot_read_messages),f=r.openMenu,p=r.closeMenu,m=r.changeItem,v=t[u+"_messages"]||[];return c.default.createElement("div",{style:{height:"100%",background:"#fff"}},c.default.createElement(d.default,{pageType:"消息",fixHead:!0,needAdd:!0,showMenu:n,openMenu:f,closeMenu:p,userInfo:a,location:location,messageCount:i}),c.default.createElement("div",{className:"page"},c.default.createElement("ul",{className:"tabs"},c.default.createElement("li",{className:(0,l.default)({item:!0,br:!0,selected:"has_read"===u}),"data-type":"has_read",onClick:m},"已读消息"),c.default.createElement("li",{className:(0,l.default)({item:!0,br:!0,selected:"hasnot_read"===u}),"data-type":"hasnot_read",onClick:m},"未读消息",i.length>0&&c.default.createElement("i",{className:"iconfont read",onClick:markAll},""))),v.length>0&&v.map(function(e){return c.default.createElement(o,s({},e,{key:e.id}))}),0===v.length&&c.default.createElement("div",{className:"no-data"},c.default.createElement("i",{className:"iconfont icon-empty"},""),"暂无数据!")))}function o(e){var t=(e.id,e.title,e.author),r=e.type,n=e.reply,a=e.topic;return c.default.createElement("div",{className:"message markdown-body"},c.default.createElement("section",{className:"user"},c.default.createElement(v.default,{tagName:"img",className:"head",src:t.avatar_url,to:"/user/"+t.loginname}),c.default.createElement("div",{className:"info"},c.default.createElement("span",{className:"cl"},c.default.createElement("span",{className:"name"},t.loginname),"at"===r&&c.default.createElement("span",{className:"name"},"在回复中@了您"),"reply"===r&&c.default.createElement("span",{className:"name"},"回复了您的话题")),c.default.createElement("span",{className:"cr"},c.default.createElement("span",{className:"name"},(0,f.getLastTimeStr)(n.create_at,!0))))),c.default.createElement("div",{className:"reply_content",dangerouslySetInnerHTML:{__html:n.content}}),c.default.createElement(v.default,{className:"topic-title",to:"/topic/"+a.id},"话题：",a.title))}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e};t.default=a;var u=r(3),c=n(u),i=r(103),l=n(i),f=r(46),p=r(102),d=n(p),m=r(105),v=n(m)},142:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var s=t[a](o),u=s.value}catch(e){return void r(e)}return s.done?void e(u):Promise.resolve(u).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),t.MARK_ALL_MESSAGES=t.UPDATE_FIELD=t.INIT=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=r(109);t.INIT=function(){var e=a(regeneratorRuntime.mark(function e(t){var r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userInfo.token,e.next=3,(0,s.getMessages)(r);case 3:return n=e.sent,e.abrupt("return",o({},t,n));case 5:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.UPDATE_FIELD=function(e,t){var r=t.key,a=t.value;return e[r]===a?e:o({},e,n({},r,a))},t.MARK_ALL_MESSAGES=function(){var e=a(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userInfo.params.token,e.next=3,(0,s.markAllMessages)();case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()}});