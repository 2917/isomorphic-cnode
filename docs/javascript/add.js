webpackJsonp([5],{265:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var u=t[a](o),c=u.value}catch(i){return void r(i)}return u.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),t.readPic=t.addReply=t.upsReply=t.markAllMessages=t.getMessages=t.addTopic=t.getUserData=t.getUserInfo=t.getTopic=t.getTopics=void 0;var u=r(266),c=n(u),i=r(206),s="https://cnodejs.org/api/v1",f=(0,i.createFetchJSON)(s);t.getTopics=function(e){return f("/topics?"+c["default"].stringify(e))},t.getTopic=function(e){return f("/topic/"+e)},t.getUserInfo=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,o,u,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/accesstoken",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify({accesstoken:e})},t.next=4,f(r,n);case 4:if(o=t.sent,u=o.success,i=o.error_msg,s=a(o,["success","error_msg"]),u){t.next=10;break}throw new Error(i);case 10:return t.abrupt("return",s);case 11:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.getUserData=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f("/user/"+e);case 2:if(r=t.sent,n=r.success,a=r.error_msg,o=r.data,n){t.next=8;break}throw new Error(a);case 8:return t.abrupt("return",o);case 9:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.addTopic=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/topics",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify(e)},t.next=4,f(r,n);case 4:if(a=t.sent,o=a.success,u=a.error_msg,i=a.topic_id,o){t.next=10;break}throw new Error(u);case 10:return t.abrupt("return",i);case 11:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.getMessages=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/messages?accesstoken="+e,t.next=3,f(r);case 3:if(n=t.sent,a=n.success,o=n.error_msg,u=n.data,a){t.next=9;break}throw new Error(o);case 9:return t.abrupt("return",u);case 10:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.markAllMessages=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/message/mark_all",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify({accesstoken:e})},t.next=4,f(r,n);case 4:if(a=t.sent,o=a.success){t.next=8;break}throw new Error(error_msg);case 8:return t.abrupt("return",o);case 9:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.upsReply=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u,i,s=e.replyId,l=e.accesstoken;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/reply/"+s+"/ups",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify({accesstoken:l})},e.next=4,f(r,n);case 4:if(a=e.sent,o=a.success,u=a.action,i=a.error_msg,o){e.next=10;break}throw new Error(i);case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.addReply=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u,i,s,l=e.topicId,p=e.accesstoken,d=e.content,v=e.replyId;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/topic/"+l+"/replies",n={accesstoken:p,content:d},v&&(n.reply_id=v),a={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify(n)},e.next=6,f(r,a);case 6:if(o=e.sent,u=o.success,i=o.error_msg,s=o.reply_id,u){e.next=12;break}throw new Error(i);case 12:return e.abrupt("return",s);case 13:case"end":return e.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.readPic=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="http://m.yueqingwang.com/common.ashx",n={method:"POST",body:JSON.stringify({img:e})},t.next=4,fetch(r,n);case 4:return a=t.sent,t.next=7,a.text();case 7:if(o=t.sent,"qrcode error"===o){t.next=10;break}throw new Error("二维码图片不清晰");case 10:return t.abrupt("return",o);case 11:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}()},291:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var u=t[a](o),c=u.value}catch(i){return void r(i)}return u.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=r(194),f=a(s),l=r(292),p=a(l),d=r(293),v=n(d),h=r(269),m=function(e){function t(){var e,r,n,a;u(this,t);for(var i=arguments.length,s=Array(i),f=0;f<i;f++)s[f]=arguments[f];return r=n=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n.name="Add",n.needLogin=!0,n.View=p["default"],n.actions=v,n.initialState={showMenu:!1,tabs:[{type:"share",text:"分享"},{type:"ask",text:"问答"},{type:"job",text:"招聘"}],tab:"share",title:"",content:"",err:"",topic_id:"",suffix:'\n        <br/>\n        来自 <a class="from" href="https://github.com/Lucifier129/isomorphic-cnode">isomorphic-cnode</a>\n        '},n.methods={openMenu:h.openMenu,closeMenu:h.closeMenu,addTopic:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var r,n,a,o,u,c,i,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.store.actions,n=r.UPDATE_FIELD,a=r.ADD_TOPIC,o=e.store.getState(),u=o.title,c=o.content,!(u.trim().length<10)){t.next=6;break}return t.abrupt("return",n({key:"err",value:"title"}));case 6:if(""!==c.trim()){t.next=8;break}return t.abrupt("return",n({key:"err",value:"content"}));case 8:return t.prev=8,t.next=11,a();case 11:i=t.sent,s=i.topic_id,e.goReplace("/topic/"+s),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](8),alert(t.t0.message);case 19:case"end":return t.stop()}},t,e,[[8,16]])}))()},updateTitle:function(e){var t=e.currentTarget,r=this.store.actions.UPDATE_FIELDS,n=t.value;r([{key:"title",value:n},{key:"err",value:""}])},updateContent:function(e){var t=e.currentTarget,r=this.store.actions.UPDATE_FIELDS,n=t.value;r([{key:"content",value:n},{key:"err",value:""}])},updateTab:function(e){var t=e.currentTarget,r=this.store.actions.UPDATE_FIELDS,n=t.value;r([{key:"tab",value:n},{key:"err",value:""}])}},a=r,c(n,a)}return i(t,e),t}(f["default"]);t["default"]=m},292:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.state,r=e.methods,n=t.userInfo,a=t.location,o=t.showMenu,c=t.tab,s=t.title,l=t.content,p=t.tabs,d=t.err,v=r.openMenu,h=r.closeMenu,m=r.addTopic,y=r.updateTitle,g=r.updateTab,w=r.updateContent;return u["default"].createElement("div",{style:{height:"100%",background:"#fff"}},u["default"].createElement(f["default"],{pageType:"主题",fixHead:!0,showMenu:o,openMenu:v,closeMenu:h,userInfo:n,location:a}),u["default"].createElement("div",{className:"add-container"},u["default"].createElement("div",{className:"line"},"选择分类：",u["default"].createElement("select",{className:"add-tab",value:c,onChange:g},p.map(function(e){var t=e.type,r=e.text;return u["default"].createElement("option",{value:t,key:t},r)}))," ",u["default"].createElement("a",{className:"add-btn",onClick:m},"发布")),u["default"].createElement("div",{className:"line"},u["default"].createElement("input",{type:"text",className:(0,i["default"])({"add-title":!0,err:"title"===d}),value:s,onChange:y,placeholder:"标题，字数10字以上",maxLength:"100"})),u["default"].createElement("textarea",{onChange:w,value:l,className:(0,i["default"])({"add-content":!0,err:"content"===d}),placeholder:"回复支持Markdown语法,请注意标记代码",rows:"35"})))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var o=r(195),u=n(o),c=r(259),i=n(c),s=(r(206),r(258)),f=n(s),l=r(261);n(l)},293:function(e,t,r){"use strict";function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var u=t[a](o),c=u.value}catch(i){return void r(i)}return u.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(t,"__esModule",{value:!0}),t.ADD_TOPIC=t.UPDATE_FIELDS=t.UPDATE_FIELD=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=r(265),c=(r(206),t.UPDATE_FIELD=function(e,t){var r=t.key,n=t.value;return e[r]===n?e:o({},e,a({},r,n))});t.UPDATE_FIELDS=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.reduce(c,e)},t.ADD_TOPIC=function(){var e=n(regeneratorRuntime.mark(function t(e){var r,n,a,c,i,s,f;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.tab,n=e.title,a=e.content,c=e.userInfo,i=e.suffix,s=c.token,t.next=4,(0,u.addTopic)({tab:r,title:n,content:a+i,accesstoken:s});case 4:return f=t.sent,t.abrupt("return",o({},e,{topic_id:f}));case 6:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}()}});