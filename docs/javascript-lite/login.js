webpackJsonp([3],{105:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var u=t[a](o),c=u.value}catch(s){return void r(s)}return u.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),t.readPic=t.addReply=t.upsReply=t.markAllMessages=t.getMessages=t.addTopic=t.getUserData=t.getUserInfo=t.getTopic=t.getTopics=void 0;var u=r(106),c=n(u),s=r(46),i="https://cnodejs.org/api/v1",f=(0,s.createFetchJSON)(i);t.getTopics=function(e){return f("/topics?"+c["default"].stringify(e))},t.getTopic=function(e){return f("/topic/"+e)},t.getUserInfo=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,o,u,s,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/accesstoken",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify({accesstoken:e})},t.next=4,f(r,n);case 4:if(o=t.sent,u=o.success,s=o.error_msg,i=a(o,["success","error_msg"]),u){t.next=10;break}throw new Error(s);case 10:return t.abrupt("return",i);case 11:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.getUserData=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f("/user/"+e);case 2:if(r=t.sent,n=r.success,a=r.error_msg,o=r.data,n){t.next=8;break}throw new Error(a);case 8:return t.abrupt("return",o);case 9:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.addTopic=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/topics",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify(e)},t.next=4,f(r,n);case 4:if(a=t.sent,o=a.success,u=a.error_msg,s=a.topic_id,o){t.next=10;break}throw new Error(u);case 10:return t.abrupt("return",s);case 11:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.getMessages=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/messages?accesstoken="+e,t.next=3,f(r);case 3:if(n=t.sent,a=n.success,o=n.error_msg,u=n.data,a){t.next=9;break}throw new Error(o);case 9:return t.abrupt("return",u);case 10:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.markAllMessages=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="/message/mark_all",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify({accesstoken:e})},t.next=4,f(r,n);case 4:if(a=t.sent,o=a.success){t.next=8;break}throw new Error(error_msg);case 8:return t.abrupt("return",o);case 9:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.upsReply=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u,s,i=e.replyId,l=e.accesstoken;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/reply/"+i+"/ups",n={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify({accesstoken:l})},e.next=4,f(r,n);case 4:if(a=e.sent,o=a.success,u=a.action,s=a.error_msg,o){e.next=10;break}throw new Error(s);case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.addReply=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o,u,s,i,l=e.topicId,p=e.accesstoken,d=e.content,v=e.replyId;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="/topic/"+l+"/replies",n={accesstoken:p,content:d},v&&(n.reply_id=v),a={method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c["default"].stringify(n)},e.next=6,f(r,a);case 6:if(o=e.sent,u=o.success,s=o.error_msg,i=o.reply_id,u){e.next=12;break}throw new Error(s);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.readPic=function(){var e=o(regeneratorRuntime.mark(function t(e){var r,n,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r="http://m.yueqingwang.com/common.ashx",n={method:"POST",body:JSON.stringify({img:e})},t.next=4,fetch(r,n);case 4:return a=t.sent,t.next=7,a.text();case 7:if(o=t.sent,"qrcode error"===o){t.next=10;break}throw new Error("二维码图片不清晰");case 10:return t.abrupt("return",o);case 11:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}()},122:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t["default"]=e,t}function a(e){return e&&e.__esModule?e:{"default":e}}function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var u=t[a](o),c=u.value}catch(s){return void r(s)}return u.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},f=r(39),l=a(f),p=r(123),d=a(p),v=r(126),m=n(v),h=r(109),g=function(e){function t(){var e,r,n,a;u(this,t);for(var s=arguments.length,f=Array(s),l=0;l<s;l++)f[l]=arguments[l];return r=n=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(f))),n.name="Login",n.View=d["default"],n.actions=m,n.initialState={showMenu:!1,token:"",alertText:"",showLoading:!1},n.methods={openMenu:h.openMenu,closeMenu:h.closeMenu,hideAlert:function(){var e=this.store.actions.UPDATE_FIELD;e({key:"alertText",value:""})},showAlert:function(e){var t=this.store.actions.UPDATE_FIELD;t({key:"alertText",value:e}),setTimeout(this.hideAlert,1e3)},switchLoading:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.store.actions.UPDATE_FIELD;t({key:"showLoading",value:e})},login:function(){var e=this;return o(regeneratorRuntime.mark(function t(){var r,n,a,o,u,c,s,f,l,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.store.actions,n=r.UPDATE_FIELD,a=r.FETCH_USER_INFO,o=e.store.getState(),u=o.token,c=o.location,u){t.next=5;break}return e.showAlert("令牌格式错误, 应为36位UUID字符串"),t.abrupt("return");case 5:return t.prev=5,t.next=8,a();case 8:s=t.sent,f=s.userInfo,l=s.token,localStorage.setItem("userInfo",JSON.stringify(i({},f,{token:l}))),p=c.query.redirect||"/user/"+f.loginname,e.goReplace(p),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](5),e.showAlert(t.t0.message);case 19:case"end":return t.stop()}},t,e,[[5,16]])}))()},handleInput:function(e){var t=e.currentTarget,r=this.store.actions.UPDATE_FIELD;r({key:"token",value:t.value})},readPic:function(e){var t=this,r=e.currentTarget;return o(regeneratorRuntime.mark(function n(){var e,a,u,c,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e=t.store.actions,a=e.GET_TOKEN_BY_IMG,u=e.UPDATE_FIELD,c=r.files[0],s=new FileReader,s.onload=o(regeneratorRuntime.mark(function i(){var e,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=s.result,r=e.replace("base64,",""),t.switchLoading(!0),n.prev=3,n.next=6,a(r);case 6:n.next=11;break;case 8:n.prev=8,n.t0=n["catch"](3),t.showAlert(n.t0.message);case 11:return n.prev=11,t.switchLoading(!1),n.finish(11);case 14:case"end":return n.stop()}},i,t,[[3,8,11,14]])})),s.readAsDataURL(c);case 5:case"end":return n.stop()}},n,t)}))()}},a=r,c(n,a)}return s(t,e),t}(l["default"]);t["default"]=g},123:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.state,r=e.methods,n=t.token,a=t.alertText,o=t.showLoading,c=t.userInfo,i=t.location,l=t.showMenu,d=r.openMenu,v=r.closeMenu,m=r.handleInput,h=r.readPic,g=r.login;return u["default"].createElement("div",{style:{height:"100%",background:"#fff"}},u["default"].createElement(s["default"],{pageType:"登录",fixHead:!0,showMenu:l,openMenu:d,closeMenu:v,location:i,userInfo:c}),u["default"].createElement("section",{className:"page-body"},u["default"].createElement("div",{className:"label"},u["default"].createElement("input",{className:"txt",type:"text",placeholder:"Access Token",maxLength:"36",value:n,onChange:m})),u["default"].createElement("div",{className:"label"},u["default"].createElement("button",{className:"button"},"选择二维码图片"),u["default"].createElement("input",{className:"file",type:"file",id:"file_upload",onChange:h,accept:"image/*",capture:"camera"}),u["default"].createElement("button",{className:"button",onClick:g},"登录"))),a&&u["default"].createElement(p["default"],{content:a}),o&&u["default"].createElement(f["default"],{text:"二维码识别中"}))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var o=r(3),u=n(o),c=r(98),s=n(c),i=r(124),f=n(i),l=r(125),p=n(l)},124:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.text;return u["default"].createElement("div",{id:"wxloading",className:"wx_loading"},u["default"].createElement("div",{className:"wx_loading_inner"},u["default"].createElement("i",{className:"wx_loading_icon"}),t,"..."))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var o=r(3),u=n(o)},125:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function a(e){var t=e.content;return u["default"].createElement("div",{id:"wxAlert",className:"wx_loading"},u["default"].createElement("div",{id:"wx_alert_inner",className:"wx_alert_inner"},t))}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a;var o=r(3),u=n(o)},126:function(e,t,r){"use strict";function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function n(a,o){try{var u=t[a](o),c=u.value}catch(s){return void r(s)}return u.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),t.FETCH_USER_INFO=t.UPDATE_FIELD=t.GET_TOKEN_BY_IMG=void 0;var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},u=r(105);t.GET_TOKEN_BY_IMG=function(){var e=a(regeneratorRuntime.mark(function t(e,r){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,u.readPic)(r);case 2:return n=t.sent,t.abrupt("return",o({},e,{token:n}));case 4:case"end":return t.stop()}},t,void 0)}));return function(t,r){return e.apply(this,arguments)}}(),t.UPDATE_FIELD=function(e,t){var r=t.key,a=t.value;return e[r]===a?e:o({},e,n({},r,a))},t.FETCH_USER_INFO=function(){var e=a(regeneratorRuntime.mark(function t(e){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.token,t.next=3,(0,u.getUserInfo)(r);case 3:return n=t.sent,t.abrupt("return",o({},e,{userInfo:n}));case 5:case"end":return t.stop()}},t,void 0)}));return function(t){return e.apply(this,arguments)}}()}});